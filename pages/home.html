<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome Home ‚Äì Lala‚Äôs Closet</title>

  <!-- üå∏ Styles -->
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/sidebar.css" />
  <link rel="stylesheet" href="../css/toast.css" />
  <link rel="stylesheet" href="../css/home.css" />
  <link rel="stylesheet" href="../css/outfit.css" />
</head>
<body>

  <!-- üì¶ Sidebar Component -->
  <div id="sidebar-container"></div>

  <!-- üí´ Main Content -->
  <main id="main-content">
    <!-- Components will be injected here -->
  </main>

  <!-- üîî Toast Container -->
  <div id="toast-container"></div>

  <!-- üöÄ Scripts -->
  <script type="module">
    import { auth } from "../js/utils/firebase-client.js";
    import { loadCarousel } from "../js/components/carousel.js";
    import { loadStats } from "../js/components/stats.js";
    import { generateOutfit } from "../js/components/outfit.js";

    async function loadHTML(id, path) {
      const el = document.getElementById(id);
      if (!el) {
        console.warn(`‚ùå Missing container for ${path}`);
        return;
      }
      try {
        const res = await fetch(path);
        const html = await res.text();
        el.innerHTML = html;
      } catch (err) {
        console.error(`‚ùå Failed to load ${path}`, err);
      }
    }

    async function init() {
      // ‚úÖ Inject HTML partials
      await Promise.all([
        loadHTML("sidebar-container", "../js/components/sidebar.html"),
        loadHTML("main-content", "../js/components/home-sections.html"),
        loadHTML("toast-container", "../js/components/toast.html"),
      ]);

      // ‚úÖ Attach theme toggle listener (if present)
      try {
        const { setupThemeToggle } = await import("../js/components/theme-toggle.js");
        setupThemeToggle();
      } catch (err) {
        console.warn("‚ö†Ô∏è Theme toggle not loaded");
      }

      // ‚úÖ Firebase auth check
      const waitForAuth = () =>
        new Promise(resolve => {
          const unsub = auth.onAuthStateChanged(user => {
            unsub();
            if (!user) {
              window.location.href = "../login.html";
            } else {
              resolve(user);
            }
          });
        });

      await waitForAuth();

      // ‚úÖ Load dynamic modules
      loadCarousel();
      loadStats();

      // ‚úÖ Outfit generator button listener
      const genBtn = document.getElementById("generate-outfit-btn");
      if (genBtn) {
        genBtn.addEventListener("click", generateOutfit);
      } else {
        console.warn("‚ö†Ô∏è Outfit generator button missing");
      }
    }

    init();
  </script>
</body>
</html>

