import{f as A,g as $,Z as M,d as h,b as m,c as N,V as j,r as u,j as s,L as T,h as S,s as x,i as D,q as L,a as R,o as F,e as P}from"./index-Dpurs1Jy.js";import{u as z}from"./useUserRole-xi4rwFu_.js";import{u as W}from"./firebase-helpers-C5EXP52w.js";async function w(t=A.currentUser?.uid){if(!t)return{current:0,max:0,ok:!1};const[e,o,a]=await Promise.all([$(h(m,"app_settings","spaces")),$(h(m,`users/${t}/settings/limits`)),M(N(m,`users/${t}/spaces`))]),i=Number(e.data()?.maxSpacesGlobal??0),c=Number(o.data()?.maxSpaces??0),d=c>0?c:i,f=a.data().count||0;return{current:f,max:d,ok:d===0||f<d,globalMax:i,userMax:c}}const U={success(t,e){j.success(t,{id:e?.id,duration:e?.duration})},error(t,e){j.error(t,{id:e?.id,duration:e?.duration})},info(t,e){j(t,{id:e?.id,duration:e?.duration})},promise(t,{loading:e="Working…",success:o="Done!",error:a="Something went wrong."},i){return j.promise(t,{loading:e,success:o,error:a},{id:i?.id})}};function q(t){try{const e=t?.toMillis?.()??(t?.seconds?t.seconds*1e3:0);if(!e)return"";const o=Date.now()-e,a=Math.round(o/6e4);if(a<1)return"just now";if(a<60)return`${a}m ago`;const i=Math.round(a/60);return i<24?`${i}h ago`:`${Math.round(i/24)}d ago`}catch{return""}}function E({uid:t,space:e}){const[o,a]=u.useState(!1),i=u.useRef(null);async function c(){const r=prompt("Rename space:",e.name||"Untitled Space");!r||r.trim()===e.name||await S(h(m,`users/${t}/spaces/${e.id}`),{name:r.trim(),lastUpdatedAt:x()})}async function d(r){if(!r)return;const l=await W(r,{slug:`spaces_covers/${t}/${e.id}`,public:!0,metadata:{uid:t,spaceId:e.id,contentType:r.type||"image/jpeg"}}),n=l?.assets?.file?.url||l?.downloadURL||"";await S(h(m,`users/${t}/spaces/${e.id}`),{coverUrl:n,coverStoragePath:l?.fullPath||null,lastUpdatedAt:x()})}function f(r){const l=r.target.files?.[0];r.target.value="",l&&d(l)}async function y(){const r=e.status==="archived"?"active":"archived";await S(h(m,`users/${t}/spaces/${e.id}`),{status:r,lastUpdatedAt:x()})}async function v(){confirm("Delete this Space? (Items won’t be auto-removed from storage.)")&&await D(h(m,`users/${t}/spaces/${e.id}`))}return s.jsxs("div",{className:"dashboard-card",style:{padding:12,position:"relative"},children:[s.jsxs(T,{to:`/creator/spaces/${e.id}`,style:{textDecoration:"none",color:"inherit"},children:[s.jsx("div",{style:{height:150,borderRadius:12,border:"1px solid #eee",background:e.coverUrl?`url("${e.coverUrl}") center/cover no-repeat`:"linear-gradient(180deg,#faf7ff,#fff)"}}),s.jsxs("div",{style:{marginTop:10,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{style:{minWidth:0},children:[s.jsx("div",{style:{fontWeight:700,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name||"Untitled Space"}),s.jsxs("div",{className:"muted",style:{fontSize:12},children:[e.itemCount||0," files • ",q(e.lastUpdatedAt)]})]}),s.jsx("button",{className:"btn sm ghost",type:"button",onClick:r=>{r.preventDefault(),a(l=>!l)},children:"⋯"})]})]}),o&&s.jsxs("div",{className:"menu",style:{position:"absolute",right:12,top:12,background:"#fff",border:"1px solid #eee",borderRadius:12,padding:8,zIndex:5,width:180},children:[s.jsx("button",{className:"btn sm w-full",onClick:c,children:"Rename"}),s.jsx("button",{className:"btn sm w-full",onClick:()=>i.current?.click(),children:"Change cover"}),s.jsx("button",{className:"btn sm w-full",onClick:y,children:e.status==="archived"?"Unarchive":"Archive"}),s.jsx("button",{className:"btn sm danger w-full",onClick:v,children:"Delete"})]}),s.jsx("input",{ref:i,type:"file",hidden:!0,accept:"image/*",onChange:f})]})}function O({cap:t,count:e}){const o=t===1/0||t===0,a=o?"Unlimited spaces":`${Math.max(0,t-e)} left`,i=!o&&e>=t;return s.jsx("div",{className:"muted",style:{marginTop:8},children:i?s.jsxs(s.Fragment,{children:["You’ve created ",e," Spaces — upgrade or ask an admin to unlock more."]}):a})}function V(){return s.jsxs("div",{className:"dashboard-card",style:{padding:16,marginTop:12},children:[s.jsx("h3",{style:{margin:0},children:"What are Spaces?"}),s.jsx("p",{style:{margin:"6px 0 10px"},children:"Spaces are your personal content buckets. Use them to separate campaigns, themes, or projects so uploads stay organized and stress‑free."}),s.jsxs("ul",{style:{margin:0,paddingLeft:18,lineHeight:1.7},children:[s.jsx("li",{children:"✨ Stay organized — no more mixing projects"}),s.jsx("li",{children:"📂 Included on your plan (ask admin to raise your limit)"}),s.jsx("li",{children:"🖼️ Visual dashboard with thumbnails"}),s.jsx("li",{children:"🚀 Grow later — unlock more spaces"})]})]})}function _(){const t=A.currentUser?.uid||null;z();const[e,o]=u.useState([]),[a,i]=u.useState("active"),[c,d]=u.useState(1/0),[f,y]=u.useState(!0);u.useEffect(()=>{let n=!1;async function g(){if(t){y(!0);try{const{max:p}=await w(t),b=Number(p)===0?1/0:Number(p);n||d(Number.isFinite(b)?b:1/0)}catch{n||d(1/0)}finally{n||y(!1)}}}return g(),()=>{n=!0}},[t]),u.useEffect(()=>{if(!t)return;const n=L(N(m,`users/${t}/spaces`),R("createdAt","asc"));return F(n,g=>{o(g.docs.map(p=>({id:p.id,...p.data()})))})},[t]);const v=!f&&Number.isFinite(c)&&c!==0&&e.length>=c;async function r(){if(!t)return;const{ok:n,current:g,max:p}=await w(t);if(!n&&(p??0)!==0){U.error(`Space limit reached (${g}/${p}). Ask an admin to increase your limit.`);return}const C=prompt("Name your Space:");if(!C)return;const I=P(N(m,`users/${t}/spaces`),{uid:t,name:C.trim(),status:"active",itemCount:0,lastPreviewUrl:null,createdAt:x(),lastUpdatedAt:x()});await U.promise(I,{loading:"Creating your Space…",success:"Space created 🎉",error:"Couldn’t create the Space. Try again."});try{const{max:k}=await w(t);d(Number(k)===0?1/0:Number(k))}catch{}}const l=u.useMemo(()=>e.filter(n=>a==="all"?!0:(n.status||"active")===a),[e,a]);return s.jsxs("section",{className:"container",style:{padding:16},children:[s.jsxs("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between",gap:10},children:[s.jsx("h1",{style:{margin:0},children:"Spaces"}),s.jsxs("div",{className:"row",style:{gap:10},children:[s.jsxs("select",{className:"select",value:a,onChange:n=>i(n.target.value),children:[s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"archived",children:"Archived"}),s.jsx("option",{value:"all",children:"All"})]}),s.jsx("button",{className:"btn primary",onClick:r,disabled:v,title:v?"You’ve reached your spaces limit":"Create a new space",children:"+ New Space"})]})]}),s.jsx(O,{cap:Number(c)===0?1/0:c,count:e.length}),s.jsx(V,{}),s.jsxs("div",{style:{display:"grid",gap:16,gridTemplateColumns:"repeat(auto-fit,minmax(300px,1fr))",marginTop:16},children:[l.map(n=>s.jsx(E,{uid:t,space:{id:n.id,...n}},n.id)),!l.length&&s.jsxs("div",{className:"dashboard-card",style:{padding:16},children:["No ",a," spaces."," ",a!=="all"?"Try changing the filter.":"Click + New Space to get started."]})]})]})}export{_ as default};
