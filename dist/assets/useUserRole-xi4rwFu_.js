import{r as e,z as S,A as h,f as b,d as p,b as y,o as L}from"./index-Dpurs1Jy.js";const E="bestie.roleOverride";function O(){const[g,d]=e.useState(!0),[o,l]=e.useState(null),[s,v]=e.useState(null),[i,f]=e.useState(!1),[u,m]=e.useState("");e.useEffect(()=>S(b,async r=>{if(v(r?.uid||null),f(!1),l(null),!r){d(!1);return}try{const a=await h(r,!0);l(a?.claims||{})}finally{d(!1)}}),[]),e.useEffect(()=>{if(!s)return;const t=p(y,`users/${s}/settings/profile`);return L(t,a=>{f(!!a.data()?.fanEnabled)},()=>f(!1))},[s]),e.useEffect(()=>{const t=()=>{try{m(localStorage.getItem(E)||"")}catch{m("")}};t();const r=a=>{a.key===E&&t()};return window.addEventListener("storage",r),window.addEventListener("role:override-changed",t),()=>{window.removeEventListener("storage",r),window.removeEventListener("role:override-changed",t)}},[]);const n=e.useMemo(()=>o?o.admin===!0||o.role==="admin"?"admin":o.role==="creator"?"creator":"fan":"fan",[o]),c=e.useMemo(()=>n==="admin"?["admin","creator","fan"]:n==="creator"?i?["creator","fan"]:["creator"]:["fan"],[n,i]),w=e.useMemo(()=>c.includes(u)?u:n,[n,c,u]);return{role:n,effectiveRole:w,roleOptions:c,fanEnabled:i,loading:g}}export{O as u};
