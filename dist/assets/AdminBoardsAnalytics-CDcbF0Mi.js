import{r,c as u,q as U,l as X,a as Y,k as $,m as p,d as z,b as w,j as e}from"./index-Dpurs1Jy.js";import{R as g,L as G,C as v,X as b,Y as f,T as A,a as C,b as S,B as K,c as D}from"./BarChart-K5O1mw2L.js";function F(o){try{const[h,N,c]=o.split("-").map(Number);return new Date(Date.UTC(h,N-1,c)).toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return o}}function V(){const[o,h]=r.useState(14),[N,c]=r.useState(!0),[n,k]=r.useState([]),[B,R]=r.useState([]),[L,M]=r.useState([]);r.useEffect(()=>{let s=!1;return(async()=>{c(!0);const l=u(w,"admin/metrics/boards/daily"),q=U(l,Y($(),"desc"),X(o)),T=(await p(q)).docs.map(a=>({id:a.id,...a.data()})).sort((a,t)=>a.id<t.id?-1:1),W=T.map(a=>({dateKey:a.id,added:Number(a.added||0),removed:Number(a.removed||0)})),x=new Map,y=new Map;for(const a of T){const t=z(w,"admin/metrics/boards/daily",a.id);(await p(u(t,"categories"))).forEach(j=>{const d=j.data()||{},i=(d.label||"Uncategorized").trim(),m=x.get(i)||0;x.set(i,m+Number(d.count||0))}),(await p(u(t,"boards"))).forEach(j=>{const d=j.data()||{},i=`${d.uid||"?"}:${d.boardId||"?"}`,m=y.get(i)||{added:0,removed:0};y.set(i,{name:d.label||i,added:m.added+Number(d.added||0),removed:m.removed+Number(d.removed||0)})})}s||(k(W),R(Array.from(x.entries()).map(([a,t])=>({name:a,count:t})).sort((a,t)=>t.count-a.count).slice(0,12)),M(Array.from(y.values()).sort((a,t)=>t.added-a.added).slice(0,12)),c(!1))})(),()=>{s=!0}},[o]);const E=r.useMemo(()=>n.reduce((s,l)=>s+(l.added||0),0),[n]),I=r.useMemo(()=>n.reduce((s,l)=>s+(l.removed||0),0),[n]);return e.jsx("section",{className:"container",style:{padding:16},children:e.jsxs("div",{className:"dashboard-card",style:{padding:16},children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0},children:"Boards Analytics"}),e.jsx("div",{className:"muted",children:"Timeseries and top categories/boards"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("label",{className:"muted",children:"Window:"}),e.jsxs("select",{value:o,onChange:s=>h(Number(s.target.value)),children:[e.jsx("option",{value:7,children:"7 days"}),e.jsx("option",{value:14,children:"14 days"}),e.jsx("option",{value:30,children:"30 days"})]}),e.jsxs("div",{className:"muted",children:["Added: ",e.jsx("strong",{children:E})]}),e.jsxs("div",{className:"muted",children:["Removed: ",e.jsx("strong",{children:I})]})]})]}),e.jsx("div",{style:{marginTop:16,height:320},children:e.jsx(g,{children:e.jsxs(G,{data:n.map(s=>({...s,label:F(s.dateKey)})),margin:{top:10,right:20,left:0,bottom:0},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"label"}),e.jsx(f,{allowDecimals:!1}),e.jsx(A,{}),e.jsx(C,{}),e.jsx(S,{type:"monotone",dataKey:"added",name:"Added",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(S,{type:"monotone",dataKey:"removed",name:"Removed",stroke:"#ef4444",strokeWidth:2,dot:!1})]})})}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx("h3",{style:{margin:"0 0 8px"},children:"Top Categories"}),e.jsx("div",{style:{height:280},children:e.jsx(g,{children:e.jsxs(K,{data:B,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"name",interval:0,angle:-20,textAnchor:"end",height:70}),e.jsx(f,{allowDecimals:!1}),e.jsx(A,{}),e.jsx(D,{dataKey:"count",name:"Items"})]})})})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx("h3",{style:{margin:"0 0 8px"},children:"Top Boards"}),e.jsx("div",{style:{height:280},children:e.jsx(g,{children:e.jsxs(K,{data:L,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"name",interval:0,angle:-20,textAnchor:"end",height:70}),e.jsx(f,{allowDecimals:!1}),e.jsx(A,{}),e.jsx(C,{}),e.jsx(D,{dataKey:"added",name:"Added"}),e.jsx(D,{dataKey:"removed",name:"Removed"})]})})})]})]})})}export{V as default};
