import{f as w,r as t,o as v,c as N,j as e,b as x,q as D,a as B,i as U,d as C}from"./index-Dpurs1Jy.js";import{s as _,r as E}from"./board-helpers-BSw2y6wO.js";function O({onOpen:a}){const r=w.currentUser?.uid,[c,g]=t.useState([]),[l,u]=t.useState({});return t.useEffect(()=>{if(!r)return;const d=v(N(x,`users/${r}/boards`),h=>{const m=h.docs.map(n=>({id:n.id,...n.data()}));g(m),m.forEach(n=>{v(N(x,`users/${r}/boards/${n.id}/items`),b=>{u(o=>({...o,[n.id]:b.size}))})})});return()=>d?.()},[r]),e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"card__body",children:[e.jsx("h3",{className:"card__title",children:"My Boards"}),e.jsxs("div",{className:"boards-grid",children:[c.map(d=>e.jsxs("button",{className:"board-card",onClick:()=>a?.(d),children:[d.coverUrl?e.jsx("img",{src:d.coverUrl,alt:"",className:"cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"cover placeholder"}),e.jsxs("div",{className:"meta",children:[e.jsx("div",{className:"label",children:d.label||d.key}),e.jsxs("div",{className:"muted",children:[l[d.id]??0," item",(l[d.id]??0)!==1?"s":""]})]})]},d.id)),!c.length&&e.jsx("div",{className:"muted",children:"No boards yet. Create one in the Toolbox → Boards tab."})]})]}),e.jsx("style",{children:`
        .boards-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:16px; }
        .board-card { text-align:left; border:1px solid #eee; background:#fff; border-radius:14px; overflow:hidden; padding:0; cursor:pointer; }
        .board-card .cover { width:100%; height:180px; object-fit:cover; display:block; }
        .board-card .cover.placeholder { background: #f3f4f6; }
        .board-card .meta { padding:10px 12px; }
        .board-card .label { font-weight:600; }
      `})]})}function P({board:a}){const r=w.currentUser?.uid,[c,g]=t.useState([]),[l,u]=t.useState(!!a?.public),[d,h]=t.useState("");t.useEffect(()=>{u(!!a?.public)},[a?.public]),t.useEffect(()=>{if(!r||!a?.id)return;const s=D(N(x,`users/${r}/boards/${a.id}/items`),B("order","asc")),i=v(s,f=>g(f.docs.map(p=>({id:p.id,...p.data()}))));return()=>i?.()},[r,a?.id]);async function m(s){!r||!a?.id||await U(C(x,`users/${r}/boards/${a.id}/items/${s}`))}function n(s){return`${window.location.origin}/b/${r}/${a.id}?s=${s||a?.shareId||""}`}async function b(s){if(!r||!a?.id)return;const{shareId:i}=await _({uid:r,boardId:a.id,publicOn:s});u(!!s),h(n(i))}const[o,k]=t.useState(null),j=t.useMemo(()=>c.map(s=>s.id),[c]);function S(s,i){k(i),s.dataTransfer.effectAllowed="move"}function I(s){s.preventDefault(),s.dataTransfer.dropEffect="move"}async function $(s,i){if(s.preventDefault(),!o||!i||o===i)return;const f=j.indexOf(o),p=j.indexOf(i);if(f<0||p<0)return;const y=j.slice();y.splice(p,0,y.splice(f,1)[0]),await E({uid:r,boardId:a.id,orderedItemDocIds:y}),k(null)}return e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[e.jsx("h3",{className:"card__title",style:{margin:0},children:a?.label||a?.key}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxs("label",{className:"tool-check",title:"Let anyone view this board via a link",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:s=>b(s.target.checked)}),e.jsx("span",{className:"tool-title",children:"Public link"})]}),l&&e.jsx("button",{className:"tb-btn",onClick:()=>{const s=d||n(a?.shareId);navigator.clipboard?.writeText(s),alert("Share link copied!")},children:"Copy link"})]})]}),e.jsxs("div",{className:"masonry",children:[c.map(s=>e.jsxs("div",{className:`pin ${o===s.id?"dragging":""}`,draggable:!0,onDragStart:i=>S(i,s.id),onDragOver:I,onDrop:i=>$(i,s.id),title:"Drag to reorder",children:[s.previewUrl?e.jsx("img",{src:s.previewUrl,alt:"",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"ph"}),e.jsx("div",{className:"pin-actions",children:e.jsx("button",{className:"tb-btn danger",onClick:()=>m(s.id),children:"Remove"})})]},s.id)),!c.length&&e.jsx("div",{className:"muted",children:"No items yet."})]})]}),e.jsx("style",{children:`
        .masonry { column-width: 260px; column-gap: 16px; }
        .pin { break-inside: avoid; margin: 0 0 16px; border:1px solid #eee; border-radius: 14px; overflow: hidden; background:#fff; cursor: grab; }
        .pin.dragging { opacity:.6; }
        .pin img, .pin .ph { width:100%; display:block; }
        .pin .ph { height: 240px; background:#f3f4f6; }
        .pin-actions { display:flex; justify-content:flex-end; padding:8px; }
        .tb-btn { font-size:.85rem; padding:.3rem .55rem; border-radius:8px; border:1px solid #e5e7eb; background:#fff; }
        .tb-btn.danger { color:#b91c1c; border-color:#fca5a5; background:#fff5f5; }
      `})]})}function q(){const[a,r]=t.useState(null);return e.jsxs("div",{className:"boards-page grid-2",children:[e.jsx("div",{className:"left",children:e.jsx(O,{onOpen:r})}),e.jsx("div",{className:"right",children:a?e.jsx(P,{board:a}):e.jsx("div",{className:"muted",style:{padding:16},children:"Select a board…"})}),e.jsx("style",{children:`
        .boards-page.grid-2 { display:grid; grid-template-columns: 380px 1fr; gap:16px; }
        @media (max-width: 1000px) { .boards-page.grid-2 { grid-template-columns: 1fr; } .right { order:-1; } }
      `})]})}export{q as default};
