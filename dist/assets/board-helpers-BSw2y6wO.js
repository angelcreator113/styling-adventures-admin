import{c as p,b as i,q as h,a as v,o as D,d as l,g as f,l as x,x as A,m as C,e as k,h as y,w as q,s as u,y as I}from"./index-Dpurs1Jy.js";const m=(t="")=>String(t).toLowerCase().trim().replace(/[^\p{L}\p{N}]+/gu,"-").replace(/^-+|-+$/g,"");function $(t=12){const a="abcdefghijklmnopqrstuvwxyz0123456789";let o="";for(let s=0;s<t;s++)o+=a[Math.floor(Math.random()*a.length)];return o}const M=(t,a)=>`/b/${t}/${a}`;function j(t,a,o){if(!t)return()=>{};const s=p(i,`users/${t}/boards`);let r;try{r=h(s,v("updatedAt","desc"))}catch{r=s}return D(r,n=>{const c=n.docs.map(d=>({id:d.id,...d.data()}));a?.(c)},n=>{console.warn("[watchMyBoards] onSnapshot error:",n)})}const E=(t,a)=>j(t,a);async function B(t,a,o,s={}){const r=m(a),e=l(i,`users/${t}/boards/${r}`);return(await f(e)).exists()||await q(e,{uid:t,key:r,label:o||a,locked:!!s.locked,public:!1,visibility:"private",shareId:$(12),coverUrl:s.coverUrl||"",createdAt:u(),updatedAt:u(),itemsCount:0}),r}async function L({uid:t,boardId:a,publicOn:o}){const s=l(i,`users/${t}/boards/${a}`),r=await f(s);if(!r.exists())return null;const e=r.data()?.shareId||$(12);return await y(s,{public:!!o,visibility:o?"public":"private",shareId:e,updatedAt:u()}),{shareId:e,sharePath:M(t,a)}}async function w({uid:t,boardId:a,itemId:o,previewUrl:s="",category:r=""}){const e=l(i,`users/${t}/boards/${a}`),n=await f(e);if(!n.exists())return;const c=p(i,`users/${t}/boards/${a}/items`),d=h(c,A("itemId","==",o),x(1));if(!(await C(d)).empty)return;const g=Date.now();await k(c,{itemId:o,previewUrl:s,category:r,addedAt:u(),order:g}),!n.data()?.coverUrl&&s&&await y(e,{coverUrl:s,updatedAt:u()})}async function R({uid:t,boardId:a,orderedItemDocIds:o=[]}){const s=I(i),r=Date.now();o.forEach((e,n)=>{const c=l(i,`users/${t}/boards/${a}/items/${e}`);s.update(c,{order:r+n})}),await s.commit()}async function P(t){await B(t,"just-in","Just In",{locked:!0})}async function T({uid:t,itemId:a,category:o="",previewUrl:s=""}){if(!t||!a)return;await P(t),await w({uid:t,boardId:"just-in",itemId:a,previewUrl:s,category:o});const r=l(i,`users/${t}/settings/boards`),e=await f(r);if(!(e.exists()?!!e.data()?.autoByCategory:!0)||!o)return;const c=`cat-${m(o)}`,b=await B(t,c,o);await w({uid:t,boardId:b,itemId:a,previewUrl:s,category:o})}export{T as a,w as b,P as e,E as l,R as r,L as s};
