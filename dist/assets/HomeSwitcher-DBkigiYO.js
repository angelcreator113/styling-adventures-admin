import{r as n,f as P,z as D,v as q,n as O,p as F,j as e,q as _,c as w,b as y,a as C,l as k,m as T,$ as v,w as Y,d as B,s as z,a0 as M,a1 as H,o as W,g as G,L as g,a2 as J,a3 as S}from"./index-Dpurs1Jy.js";function K({limit:a=12,className:r=""}){const[c,d]=n.useState([]),[m,h]=n.useState({}),[i,p]=n.useState(!0),[N,b]=n.useState(null);return n.useEffect(()=>{let t=!1,x=()=>{};const o=async u=>{if(p(!0),b(null),!u){t||(d([]),p(!1));return}try{const s=_(w(y,`users/${u.uid}/closet`),C("uploadedAt","desc"),k(a)),l=await T(s);if(t)return;d(l.docs.map(j=>({id:j.id,...j.data()})))}catch(s){t||b(s)}finally{t||p(!1)}};return o(P.currentUser),x=D(P,o),()=>{t=!0,x&&x()}},[a]),n.useEffect(()=>{let t=!0;return(async()=>{const x=[];for(const o of c){const u=o.path||o.storagePath||"";!(o.imageUrl||o.url)&&u&&!m[u]&&x.push(u)}for(const o of x)try{const u=await q(O(F,o));if(!t)return;h(s=>({...s,[o]:u}))}catch{}})(),()=>{t=!1}},[c,m]),i?e.jsx("p",{className:"muted op-70",children:"Loadingâ€¦"}):N?e.jsx("p",{className:"muted op-70",children:"Couldnâ€™t load items."}):c.length===0?e.jsx("p",{className:"muted op-70",children:"No recent items found."}):e.jsx("div",{className:`justin-row ${r}`,children:c.map(t=>{const x=t.path||t.storagePath||"",o=t.imageUrl||t.url||(x?m[x]:""),u=t.title||t.fileName||t.category||"Closet item";return e.jsxs("div",{className:"justin-card",title:u,children:[o?e.jsx("img",{src:o,alt:u,loading:"lazy",decoding:"async"}):e.jsx("div",{className:"justin-skel","aria-hidden":!0}),t.category&&e.jsx("span",{className:"justin-badge",children:t.category})]},t.id)})})}async function V({uid:a,email:r}){try{const c=await fetch("/admin/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({uid:a,email:r})});if(!c.ok)throw new Error("Failed to create checkout session.");const{url:d}=await c.json();d&&window.location.assign(d)}catch(c){console.warn("beginCreatorCheckout stub:",c),alert("Checkout is not wired up yet. After you connect billing, this will send users to the payment page.")}}function Q({compact:a=!1}){const r=P.currentUser,[c,d]=n.useState(!1),m=async()=>{if(!r)return v.error("Please sign in first.");d(!0);const h=v.loading("Preparing your Creator upgradeâ€¦");try{await Y(B(y,`users/${r.uid}/settings/profile`),{uid:r.uid,roleChoice:"creator",checkoutRequired:!0,upgradedFromFan:!0,upgradedAt:z()},{merge:!0}),v.success("Almost there! Redirecting to checkoutâ€¦"),v.dismiss(h),await V({uid:r.uid,email:r.email||""})}catch(i){console.error(i),v.dismiss(h),v.error("Could not start upgrade. Please try again.")}finally{d(!1)}};return e.jsxs("div",{className:"dashboard-card",style:{padding:a?16:24},children:[e.jsx("h3",{style:{marginTop:0},children:"Become a Creator"}),e.jsxs("p",{className:"muted",style:{marginTop:4},children:["Publish your content with ",e.jsx("strong",{children:"Spaces"}),", unlock insights, and grow your audience. Upgrade today and get ",e.jsx("strong",{children:"2 Spaces for free"})," as a thankâ€‘you for supporting the platform."]}),e.jsxs("ul",{style:{margin:"10px 0 16px",paddingLeft:18,lineHeight:1.7},children:[e.jsx("li",{children:"Creator Studio with uploads & organization"}),e.jsx("li",{children:"Spaces for campaigns/themes (2 free after upgrade)"}),e.jsx("li",{children:"Analytics and growth tools"})]}),e.jsx("button",{className:"btn primary",disabled:c,onClick:m,children:c?"Please waitâ€¦":"Upgrade to Creator"})]})}const X="public/top_picks/items",Z="public/spotlights",ee="threads",se="lastActivityAt",L=a=>new Intl.NumberFormat().format(a||0),ae=(a="Bestie")=>{const r=new Date().getHours(),c=r<12?"morning":r<18?"afternoon":"evening";return`Hey ${a}, happy ${c}!`},te=(a="")=>a.length>72?a.slice(0,69)+"â€¦":a,ce=(a="")=>Math.abs([...a].reduce((r,c)=>r+c.charCodeAt(0),0)),ne=(a="")=>`hsl(${ce(a)%360} 62% 80%)`;function re(){M();const a=P.currentUser,{effectiveRole:r}=H(),[c,d]=n.useState({spaceCap:0}),[m,h]=n.useState({total:0,categories:0,recent:0,last3:[]}),[i,p]=n.useState([]),[N,b]=n.useState(null),[t,x]=n.useState([]),o=n.useRef(null);n.useEffect(()=>{if(!a)return;const s=_(w(y,`users/${a.uid}/closet`),C("uploadedAt","desc"));return W(s,j=>{const A=j.docs.map(f=>({id:f.id,...f.data()})),U=new Set;let E=0;const I=Date.now(),$=10080*60*1e3;A.forEach(f=>{f.category&&U.add((f.category||"").toLowerCase());const R=f.uploadedAt?.toMillis?.()??(f.uploadedAt?.seconds?f.uploadedAt.seconds*1e3:0);R&&I-R<$&&E++}),h({total:A.length,categories:U.size,recent:E,last3:A.slice(0,3)})})},[a?.uid]),n.useEffect(()=>{a&&(async()=>{try{const s=B(y,`users/${a.uid}/settings/limits`),l=await G(s);if(l.exists()){const j=l.data()||{};d({spaceCap:Number(j.spaceCap??0)})}}catch{d({spaceCap:0})}})()},[a?.uid]),n.useEffect(()=>{(async()=>{try{const s=_(w(y,X),C("rank","asc"),k(12)),l=await T(s);p(l.docs.map(j=>({id:j.id,...j.data()})))}catch{p([])}})()},[]),n.useEffect(()=>{(async()=>{try{const s=_(w(y,Z),C("featuredAt","desc"),k(1)),l=await T(s);b(l.docs[0]?.data()||null)}catch{b(null)}})()},[]),n.useEffect(()=>{(async()=>{try{const s=_(w(y,ee),C(se,"desc"),k(3)),l=await T(s);x(l.docs.map(j=>({id:j.id,...j.data()})))}catch{x([])}})()},[]);const u=a?.displayName?.split(" ")[0]||"Bestie";return e.jsxs("section",{className:"container",style:{padding:16},children:[r==="fan"&&e.jsx("div",{style:{marginBottom:12},children:e.jsx(Q,{})}),e.jsxs("div",{className:"home-hero dashboard-card",children:[e.jsxs("div",{className:"hero-copy",children:[e.jsx("h1",{className:"hero-title",children:"Bestie, welcome to your style adventure!"}),e.jsxs("p",{className:"hero-sub",children:[ae(u)," Iâ€™m Lala â€” letâ€™s upload your fav pieces, browse Top Picks, and build looks that feel like ",e.jsx("em",{children:"you"}),"."]}),e.jsxs("div",{className:"hero-actions",children:[e.jsx(g,{to:"/closet",className:"btn primary",children:"Start Your Closet"}),e.jsx(g,{to:"/outfits/builder",className:"btn ghost",children:"Build an Outfit"})]})]}),e.jsx("div",{className:"hero-side",children:e.jsxs("div",{className:"stat-row",children:[e.jsxs("div",{className:"stat-pill",children:[e.jsx("div",{className:"num",children:L(m.total)}),e.jsx("div",{className:"lbl",children:"Total Pieces"})]}),e.jsxs("div",{className:"stat-pill",children:[e.jsx("div",{className:"num",children:L(m.categories)}),e.jsx("div",{className:"lbl",children:"Categories"})]}),e.jsxs("div",{className:"stat-pill",children:[e.jsx("div",{className:"num",children:L(m.recent)}),e.jsx("div",{className:"lbl",children:"Recent Uploads"})]})]})})]}),e.jsxs("section",{className:"section",children:[e.jsxs("header",{className:"section__hd",children:[e.jsx("h2",{className:"section__title",children:"Lalaâ€™s Weekly Top Picks"}),e.jsx("div",{className:"section__actions",children:e.jsx(g,{to:"/community/forum",className:"btn sm",children:"Give Suggestions"})})]}),e.jsx("div",{className:"carousel",ref:o,children:(i.length?i:Array.from({length:6})).map((s,l)=>e.jsxs("article",{className:"card",children:[e.jsx("div",{className:"card__thumb",children:s?.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.title||""}):e.jsx("div",{className:"skel"})}),e.jsxs("div",{className:"card__body",children:[e.jsx("div",{className:"card__title",children:s?.title||"Coming soonâ€¦"}),s?.note&&e.jsx("div",{className:"muted",children:te(s.note)})]})]},s?.id||`sk-${l}`))})]}),e.jsxs("section",{className:"section",children:[e.jsx("header",{className:"section__hd",children:e.jsx("h2",{className:"section__title",children:"Start Your Closet"})}),e.jsxs("div",{className:"cta-grid",children:[e.jsxs("div",{className:"cta-card",children:[e.jsx("p",{children:"Upload what you own, tag by category, and watch your wardrobe get organized & gorgeous."}),e.jsxs("div",{className:"row",style:{gap:8},children:[e.jsx(g,{to:"/closet",className:"btn primary",children:"Get Started"}),e.jsx("span",{className:"muted",children:"Weâ€™ll help with categories & tags."})]})]}),e.jsxs("div",{className:"mini-feed",children:[e.jsx("h3",{className:"mini-feed__title",children:"Just In"}),e.jsx(K,{limit:12})]})]})]}),e.jsxs("section",{className:"section",children:[e.jsxs("header",{className:"section__hd",children:[e.jsx("h2",{className:"section__title",children:"Fan Spotlight"}),e.jsx("div",{className:"section__actions",children:e.jsx(g,{to:"/community/spotlights",className:"btn sm",children:"Submit Your Look"})})]}),e.jsx("div",{className:"spotlight",children:e.jsxs("article",{className:"card wide",children:[e.jsx("div",{className:"card__thumb",children:N?.imageUrl?e.jsx("img",{src:N.imageUrl,alt:N?.userName||""}):e.jsx("div",{className:"skel"})}),e.jsxs("div",{className:"card__body",children:[e.jsx("div",{className:"card__title",children:N?.userName||"Your Name Here"}),e.jsx("p",{className:"muted",children:N?.quote||"Share your fave fit for a chance to be featured next week!"})]})]})})]}),e.jsxs("section",{className:"section",children:[e.jsx("header",{className:"section__hd",children:e.jsx("h2",{className:"section__title",children:"Plan an Event Outfit"})}),e.jsxs("div",{className:"planner-tease",children:[e.jsx("p",{children:"Tell me your event and the vibe â€” Iâ€™ll help you style it and add it to your calendar."}),e.jsx(g,{to:"/planner",className:"btn primary",children:"Plan an Outfit"})]})]}),e.jsxs("section",{className:"section",children:[e.jsxs("header",{className:"section__hd",children:[e.jsx("h2",{className:"section__title",children:"Bestie Chat"}),e.jsx("div",{className:"section__actions",children:e.jsx(g,{to:"/community/forum",className:"btn sm",children:"Browse More Topics"})})]}),e.jsxs("div",{className:"chat-peek",children:[e.jsxs("div",{className:"chat-head",children:[e.jsxs("div",{className:"chat-tabs",children:[e.jsx("span",{className:"tab is-live",children:"#style-help"}),e.jsx("span",{className:"tab",children:"#event-fits"}),e.jsx("span",{className:"tab",children:"#shoe-talk"})]}),e.jsx(g,{to:"/community/forum",className:"btn sm",children:"Add Your Thoughts"})]}),e.jsx("div",{className:"chat-stream",children:(t.length?t:[{id:"t1",title:"Thread loadingâ€¦",replyCount:0,author:"evoni"}]).slice(0,3).map((s,l)=>e.jsxs("div",{className:"msg",children:[e.jsx("div",{className:"avatar",style:{background:ne(s.author||`u${l}`)},"aria-hidden":!0,children:e.jsx("span",{className:"dot"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"meta",children:[e.jsxs("span",{className:"handle",children:["@",s.author||"bestie"]}),e.jsx("span",{children:"in"}),e.jsx("strong",{children:"#style-help"}),e.jsxs("span",{className:"reacts",children:[e.jsxs("span",{className:"react",children:["â¤ï¸ ",Math.max(0,(s.replyCount||0)-1)]}),e.jsxs("span",{className:"react",children:["ðŸ’¬ ",s.replyCount||0]})]})]}),e.jsx("div",{className:"bubble",children:s.excerpt||`Yâ€™all are serving LEWKS in here ðŸ˜ â€” â€œ${s.title||"Thread loadingâ€¦"}â€`})]})]},s.id||l))})]})]}),e.jsxs("section",{className:"section",children:[e.jsx("header",{className:"section__hd",children:e.jsx("h2",{className:"section__title",children:"The Bestie Lounge"})}),e.jsxs("div",{className:"lounge",children:[e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"VIP"}),e.jsx("p",{className:"muted",style:{marginTop:6},children:"Behind-the-scenes Lala content, AI fantasy fits, badges & special styling events."})]}),e.jsx(g,{to:"/vip",className:"btn primary",children:"Enter the Bestie Lounge"})]})]})]})}function le(){const{loading:a,effectiveRole:r}=H(),c=J();if(a)return e.jsxs("section",{className:"container",style:{padding:16},children:[e.jsxs("div",{className:"dashboard-card",role:"status","aria-live":"polite",style:{display:"flex",gap:12,alignItems:"center",padding:12},children:[e.jsx("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #ccc",borderTopColor:"#7c3aed",animation:"spin .9s linear infinite"}}),e.jsx("span",{children:"Loadingâ€¦"})]}),e.jsx("style",{children:"@keyframes spin{to{transform:rotate(360deg)}}"})]});const d=n.useMemo(()=>({admin:"/admin/home",creator:"/creator/home",fan:"/home"}),[]),m=i=>i.startsWith("/admin")?"admin":i.startsWith("/creator")?"creator":"fan",h=n.useRef({path:"",ts:0});if(r==="admin"){const i=d.admin;if(m(c.pathname)!=="admin"){const p=Date.now();if(h.current.path!==i||p-h.current.ts>300)return h.current={path:i,ts:p},e.jsx(S,{to:i,replace:!0})}return e.jsx(S,{to:i,replace:!0})}if(r==="creator"){const i=d.creator;if(m(c.pathname)!=="creator"){const p=Date.now();if(h.current.path!==i||p-h.current.ts>300)return h.current={path:i,ts:p},e.jsx(S,{to:i,replace:!0})}return e.jsx(S,{to:i,replace:!0})}return e.jsx(re,{})}export{le as default};
