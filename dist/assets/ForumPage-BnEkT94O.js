import{a0 as J,r,q as Q,l as U,a as V,c as b,o as S,b as h,j as a,L as H,f as m,d as N,i as C,e as T,h as D,ac as Z,s as v,z as X,ad as Y,ae as ee,af as ae,ag as se,ah as te,ai as ne,aj as re,ak as ie,al as ce,am as le,an as oe,ao as de,ap as ue,aq as he,ar as me,as as pe,at as ye,au as fe,av as ge,aw as xe,ax as be,ay as je,az as Ne,aA as Ce,aB as ve,aC as _e,aD as Ae,aE as ke,aF as Se,aG as Te,aH as De,aI as Ee,aJ as Fe,aK as Pe,a6 as Le,aL as Ie,aM as Re,k as $e,aN as we,aO as Be,aP as Qe,Z as Ue,g as Ve,m as Oe,aQ as Me,P as We,U as qe,w as ze,a7 as Ge,x as Ke,y as Je}from"./index-Dpurs1Jy.js";const He=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:Y,AggregateField:ee,AggregateQuerySnapshot:ae,Bytes:se,CollectionReference:te,DocumentReference:ne,DocumentSnapshot:re,FieldPath:ie,FieldValue:ce,Firestore:le,FirestoreError:oe,GeoPoint:de,Query:ue,QueryCompositeFilterConstraint:he,QueryConstraint:me,QueryDocumentSnapshot:pe,QueryFieldFilterConstraint:ye,QueryLimitConstraint:fe,QueryOrderByConstraint:ge,QuerySnapshot:xe,QueryStartAtConstraint:be,SnapshotMetadata:je,Timestamp:Ne,VectorValue:Ce,WriteBatch:ve,_AutoId:_e,_ByteString:Ae,_DatabaseId:ke,_DocumentKey:Se,_EmptyAuthCredentialsProvider:Te,_FieldPath:De,_cast:Ee,_logWarn:Fe,_validateIsNotUsedTogether:Pe,addDoc:T,collection:b,collectionGroup:Le,connectFirestoreEmulator:Ie,count:Re,deleteDoc:C,doc:N,documentId:$e,ensureFirestoreConfigured:we,executeWrite:Be,getAggregateFromServer:Qe,getCountFromServer:Ue,getDoc:Ve,getDocs:Oe,getFirestore:Me,increment:We,initializeFirestore:qe,limit:U,onSnapshot:S,orderBy:V,query:Q,serverTimestamp:v,setDoc:ze,startAfter:Ge,updateDoc:D,where:Ke,writeBatch:Je},Symbol.toStringTag,{value:"Module"}));function Ze(){const[d,p]=r.useState(null);return r.useEffect(()=>{const c=async u=>{if(!u)return p(null);const l=await u.getIdTokenResult();p(l.claims?.admin?"admin":l.claims?.role||null)};return c(m.currentUser),X(m,c)},[]),d}const x=d=>new Intl.NumberFormat().format(d||0);function Xe({onCreate:d,onCancel:p,pending:c}){const[u,l]=r.useState(""),[j,y]=r.useState("");return a.jsxs("div",{className:"lobby-new",children:[a.jsx("input",{className:"lobby-input",placeholder:"Thread titleâ€¦",value:u,onChange:f=>l(f.target.value),maxLength:120}),a.jsx("input",{className:"lobby-input",placeholder:"Tags (comma)â€¦ e.g. style-help, event-fits",value:j,onChange:f=>y(f.target.value)}),a.jsxs("div",{className:"lobby-actions",children:[a.jsx("button",{className:"btn ghost",onClick:p,disabled:c,children:"Cancel"}),a.jsx("button",{className:"btn primary",disabled:c||!u.trim(),onClick:()=>d({title:u,tags:j}),children:c?"Creatingâ€¦":"Create"})]})]})}function Ye({pageSize:d=100}){const c=Ze()==="admin",u=J(),[l,j]=r.useState([]),[y,f]=r.useState(!0),[_,E]=r.useState(""),[g,F]=r.useState(""),[P,A]=r.useState(!1),[O,L]=r.useState(!1),M=r.useRef(),[I,W]=r.useState({});r.useEffect(()=>{const e=Q(b(h,"threads"),V("lastActivityAt","desc"),U(d));return S(e,t=>{const i=t.docs.map(n=>({id:n.id,...n.data()}));i.sort((n,o)=>{const w=n.pinned?1:0,B=o.pinned?1:0;if(w!==B)return B-w;const K=n.lastActivityAt?.seconds||0;return(o.lastActivityAt?.seconds||0)-K}),j(i),f(!1)})},[d]),r.useEffect(()=>{const e=l.map(s=>S(b(h,`threads/${s.id}/reactions`),t=>{const i={heart:0,fire:0,star:0,mine:{}};t.forEach(n=>{const o=n.data();o.type==="heart"&&i.heart++,o.type==="fire"&&i.fire++,o.type==="star"&&i.star++,m.currentUser&&n.id.startsWith(m.currentUser.uid+"_")&&(i.mine[o.type]=!0)}),W(n=>({...n,[s.id]:i}))}));return()=>e.forEach(s=>s&&s())},[l.map(e=>e.id).join("|")]);const q=r.useMemo(()=>{const e=new Map;return l.forEach(s=>(s.tags||[]).forEach(t=>e.set(t,(e.get(t)||0)+1))),Array.from(e.entries()).sort((s,t)=>t[1]-s[1]).slice(0,8).map(([s,t])=>({name:s,count:t}))},[l]),R=r.useMemo(()=>{let e=l;const s=_.trim().toLowerCase();return g&&(e=e.filter(t=>(t.tags||[]).includes(g))),s&&(e=e.filter(t=>`${t.title} ${(t.tags||[]).join(" ")}`.toLowerCase().includes(s))),e},[l,_,g]);async function k(e,s){const t=m.currentUser;if(!t)return u("/login");const i=I[e]?.mine?.[s],n=N(h,`threads/${e}/reactions/${t.uid}_${s}`);try{i?await C(n):(await T(b(h,`threads/${e}/reactions`),{}),await D(n,{}))}catch{}try{i?await C(n):await(await Z(async()=>{const{setDoc:o}=await Promise.resolve().then(()=>He);return{setDoc:o}},void 0)).setDoc(n,{type:s,uid:t.uid,createdAt:v()})}catch(o){console.warn(o)}}async function z({title:e,tags:s}){if(c){L(!0);try{const t=v(),i=s.split(",").map(n=>n.trim().toLowerCase()).filter(Boolean).slice(0,6);await T(b(h,"threads"),{title:e.trim(),tags:i,excerpt:"New topic ðŸ‘€",pinned:!1,locked:!1,replyCount:0,likeCount:0,createdAt:t,lastActivityAt:t,createdBy:{uid:m.currentUser?.uid||null,name:m.currentUser?.displayName||"Lala"}}),A(!1),E("")}catch(t){console.warn("create thread failed",t),alert("Could not create thread.")}finally{L(!1)}}}async function $(e,s){if(c)try{const t=l.find(i=>i.id===e);await D(N(h,"threads",e),{[s]:!t?.[s],updatedAt:v()})}catch(t){console.warn("update failed",t)}}async function G(e){if(!(!c||!confirm("Delete this thread and its messages?")))try{await C(N(h,"threads",e))}catch(s){console.warn("delete failed",s)}}return a.jsxs("section",{className:"chat-lobby",children:[a.jsx("div",{className:"chat-lobby__bg","aria-hidden":!0}),a.jsxs("header",{className:"lobby-hd",children:[a.jsxs("div",{className:"lobby-tags",children:[a.jsx("button",{className:`tag ${g?"":"is-on"}`,onClick:()=>F(""),type:"button",children:"#all"}),q.map(e=>a.jsxs("button",{className:`tag ${g===e.name?"is-on":""}`,onClick:()=>F(s=>s===e.name?"":e.name),type:"button",title:`${e.count} threads`,children:["#",e.name]},e.name))]}),a.jsxs("div",{className:"lobby-tools",children:[a.jsx("input",{ref:M,className:"lobby-search",placeholder:"Search threadsâ€¦",value:_,onChange:e=>E(e.target.value)}),c&&a.jsx("button",{className:"btn",onClick:()=>A(e=>!e),children:P?"Close Form":"New Thread"})]})]}),c&&P&&a.jsx(Xe,{pending:O,onCreate:z,onCancel:()=>A(!1)}),a.jsxs("div",{className:"lobby-grid",children:[y&&a.jsx("div",{className:"lobby-empty",children:"Loadingâ€¦"}),!y&&R.map(e=>{const s=I[e.id]||{heart:0,fire:0,star:0,mine:{}};return a.jsxs("article",{className:`thread-card ${e.pinned?"is-pinned":""} ${e.locked?"is-closed":""}`,children:[a.jsxs("div",{className:"user-pill",title:e.createdBy?.name||"Bestie",children:[a.jsx("span",{className:"u-ava","aria-hidden":!0,children:(e.createdBy?.name||"B")[0].toUpperCase()}),a.jsxs("span",{className:"u-name",children:["@",(e.createdBy?.name||"bestie").toLowerCase()]})]}),a.jsxs("h3",{className:"thread-title",children:[e.title,e.locked&&a.jsx("span",{className:"badgetxt",children:"CLOSED"}),e.pinned&&a.jsx("span",{className:"badgetxt gold",children:"PINNED"})]}),e.tags?.length?a.jsx("div",{className:"tag-row",children:e.tags.map(t=>a.jsxs("span",{className:"tag sm",children:["#",t]},t))}):null,a.jsx("p",{className:"thread-excerpt",children:e.excerpt||"Letâ€™s chat fits, links, inspo."}),a.jsxs("div",{className:"thread-meta",children:[a.jsxs("div",{className:"reacts",children:[a.jsxs("button",{className:`react ${s.mine?.heart?"is-on":""}`,title:"Love",onClick:()=>k(e.id,"heart"),children:["ðŸ’– ",a.jsx("span",{children:x(s.heart)})]}),a.jsxs("button",{className:`react ${s.mine?.star?"is-on":""}`,title:"Sparkle",onClick:()=>k(e.id,"star"),children:["âœ¨ ",a.jsx("span",{children:x(s.star)})]}),a.jsxs("button",{className:`react ${s.mine?.fire?"is-on":""}`,title:"Slay",onClick:()=>k(e.id,"fire"),children:["ðŸ”¥ ",a.jsx("span",{children:x(s.fire)})]})]}),a.jsxs("div",{className:"counts",children:[a.jsxs("span",{children:[x(e.replyCount)," replies"]}),a.jsx("span",{children:"Â·"}),a.jsxs("span",{children:[x(e.likeCount)," likes"]})]})]}),a.jsxs("div",{className:"thread-actions",children:[a.jsx(H,{to:`/community/forum/${e.id}`,className:"btn sm primary",children:"Join thread"}),c&&a.jsxs("div",{className:"admin-tools",children:[a.jsx("button",{className:"btn xs",onClick:()=>$(e.id,"pinned"),children:e.pinned?"Unpin":"Pin"}),a.jsx("button",{className:"btn xs",onClick:()=>$(e.id,"locked"),children:e.locked?"Reopen":"Close"}),a.jsx("button",{className:"btn xs danger",onClick:()=>G(e.id),children:"Delete"})]})]})]},e.id)}),!y&&R.length===0&&a.jsxs("div",{className:"lobby-empty",children:["No threads yet ",c?"â€” start one âœ¨":"â€” check back soon âœ¨"]})]})]})}function sa(){return a.jsx("section",{className:"container",style:{padding:16},children:a.jsxs("div",{className:"dashboard-card",children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h2",{className:"page-title",children:"Style Forum"}),a.jsxs("div",{className:"crumbs",children:[a.jsx("span",{children:"Community"}),a.jsx("span",{className:"crumb-sep",children:"/"}),a.jsx("span",{children:"Forum"})]})]}),a.jsx(Ye,{})]})})}export{sa as default};
