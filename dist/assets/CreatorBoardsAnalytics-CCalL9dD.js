import{f as J,r as n,q as Q,l as Z,a as ss,k as es,c as p,m as y,j as s,R as as,b as ts}from"./index-Dpurs1Jy.js";import{R as D,L as rs,C as M,X as K,Y as L,T as B,a as W,b as v,B as F,c as E}from"./BarChart-K5O1mw2L.js";function ns(l){try{const[o,x,j]=l.split("-").map(Number);return new Date(Date.UTC(o,x-1,j)).toLocaleDateString(void 0,{month:"short",day:"numeric"})}catch{return l}}function is(l){const[o,x,j]=l.split("-").map(Number);return new Date(Date.UTC(o,x-1,j)).getUTCDay()}function xs(){const l=J.currentUser?.uid,[o,x]=n.useState(14),[j,I]=n.useState(!0),[m,q]=n.useState([]),[z,X]=n.useState([]),[Y,H]=n.useState([]),[R,O]=n.useState([]),[f,V]=n.useState(Array.from({length:7},()=>Array(24).fill(0)));n.useEffect(()=>{if(!l)return;let a=!1;return(async()=>{I(!0);const t=`users/${l}/metrics/boards/daily`,g=Q(p(ts,t),ss(es(),"desc"),Z(o)),u=(await y(g)).docs.map(e=>({id:e.id,ref:e.ref,...e.data()})).sort((e,r)=>e.id.localeCompare(r.id)),b=u.map(e=>({dateKey:e.id,label:ns(e.id),views:Number(e.views||0),saves:Number(e.saves||0),clicks:Number(e.clicks||0),shares:Number(e.shares||0)})),w=new Map,N=new Map,S=new Map,$=Array.from({length:7},()=>Array(24).fill(0));for(const e of u){const r=is(e.id);(await y(p(e.ref,"categories"))).forEach(c=>{const{label:i="Uncategorized",count:d=0}=c.data()||{};w.set(i,(w.get(i)||0)+Number(d||0))}),(await y(p(e.ref,"boards"))).forEach(c=>{const{boardId:i,label:d,saves:T=0,clicks:_=0}=c.data()||{},C=i||c.id,A=N.get(C)||{name:d||C,saves:0,clicks:0};A.saves+=Number(T||0),A.clicks+=Number(_||0),N.set(C,A)}),(await y(p(e.ref,"hours"))).forEach(c=>{const i=Math.max(0,Math.min(23,Number(c.id))),d=c.data()||{},T=Number(d.saves||0)+Number(d.clicks||0);$[r][i]+=T}),(await y(p(e.ref,"links"))).forEach(c=>{const{host:i,clicks:d=0}=c.data()||{};i&&S.set(i,(S.get(i)||0)+Number(d||0))})}a||(q(b),H(Array.from(w.entries()).map(([e,r])=>({name:e,count:r})).sort((e,r)=>r.count-e.count).slice(0,12)),X(Array.from(N.values()).sort((e,r)=>r.saves+r.clicks-(e.saves+e.clicks)).slice(0,12)),O(Array.from(S.entries()).map(([e,r])=>({host:e,clicks:r})).sort((e,r)=>r.clicks-e.clicks).slice(0,12)),V($),I(!1))})(),()=>{a=!0}},[l,o]);const h=n.useMemo(()=>({views:m.reduce((a,t)=>a+(t.views||0),0),saves:m.reduce((a,t)=>a+(t.saves||0),0),clicks:m.reduce((a,t)=>a+(t.clicks||0),0),shares:m.reduce((a,t)=>a+(t.shares||0),0)}),[m]),G=n.useMemo(()=>{const a=h.views||1;return((h.saves+h.clicks)/a*100).toFixed(1)},[h]),P=n.useMemo(()=>f.flat().reduce((a,t)=>Math.max(a,t),0)||1,[f]),U=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return s.jsx("section",{className:"container",style:{padding:16},children:s.jsxs("div",{className:"dashboard-card",style:{padding:16},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[s.jsxs("div",{children:[s.jsx("h2",{style:{margin:0},children:"Creator Insights"}),s.jsxs("div",{className:"muted",children:["Your boards performance (last ",o," days)"]})]}),s.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[s.jsxs("select",{value:o,onChange:a=>x(Number(a.target.value)),children:[s.jsx("option",{value:7,children:"7 days"}),s.jsx("option",{value:14,children:"14 days"}),s.jsx("option",{value:30,children:"30 days"})]}),s.jsxs("div",{className:"muted",children:["Views: ",s.jsx("strong",{children:h.views})]}),s.jsxs("div",{className:"muted",children:["Saves: ",s.jsx("strong",{children:h.saves})]}),s.jsxs("div",{className:"muted",children:["Clicks: ",s.jsx("strong",{children:h.clicks})]}),s.jsxs("div",{className:"muted",children:["ER: ",s.jsxs("strong",{children:[G,"%"]})]})]})]}),s.jsx("div",{style:{marginTop:16,height:320},children:s.jsx(D,{children:s.jsxs(rs,{data:m,children:[s.jsx(M,{strokeDasharray:"3 3"}),s.jsx(K,{dataKey:"label"}),s.jsx(L,{allowDecimals:!1}),s.jsx(B,{}),s.jsx(W,{}),s.jsx(v,{type:"monotone",dataKey:"views",name:"Views",stroke:"#64748b",strokeWidth:2,dot:!1}),s.jsx(v,{type:"monotone",dataKey:"saves",name:"Saves",stroke:"#22c55e",strokeWidth:2,dot:!1}),s.jsx(v,{type:"monotone",dataKey:"clicks",name:"Clicks",stroke:"#a855f7",strokeWidth:2,dot:!1}),s.jsx(v,{type:"monotone",dataKey:"shares",name:"Shares",stroke:"#ef4444",strokeWidth:2,dot:!1})]})})}),s.jsxs("div",{style:{marginTop:24},children:[s.jsx("h3",{style:{margin:"0 0 8px"},children:"Best Times to Post (UTC)"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"80px repeat(24, 1fr)",gap:2,alignItems:"center"},children:[s.jsx("div",{}),Array.from({length:24}).map((a,t)=>s.jsx("div",{style:{textAlign:"center",fontSize:11,color:"#6b7280"},children:t},t)),f.map((a,t)=>s.jsxs(as.Fragment,{children:[s.jsx("div",{style:{fontSize:12,color:"#374151"},children:U[t]}),a.map((g,k)=>{const u=Math.min(1,g/P||0),b=`rgba(168, 85, 247, ${u||0})`;return s.jsx("div",{title:`${U[t]} ${k}:00 â€” ${g} engagements`,style:{height:20,borderRadius:4,background:u?b:"rgba(0,0,0,0.05)"}},`${t}-${k}`)})]},t))]}),s.jsx("div",{className:"muted",style:{marginTop:6},children:"Engagement = saves + clicks, aggregated over the window (UTC)."})]}),s.jsxs("div",{style:{marginTop:24},children:[s.jsx("h3",{style:{margin:"0 0 8px"},children:"Top Categories"}),s.jsx("div",{style:{height:260},children:s.jsx(D,{children:s.jsxs(F,{data:Y,children:[s.jsx(M,{strokeDasharray:"3 3"}),s.jsx(K,{dataKey:"name",interval:0,angle:-20,textAnchor:"end",height:70}),s.jsx(L,{allowDecimals:!1}),s.jsx(B,{}),s.jsx(E,{dataKey:"count",name:"Items"})]})})})]}),s.jsxs("div",{style:{marginTop:24},children:[s.jsx("h3",{style:{margin:"0 0 8px"},children:"Top Boards"}),s.jsx("div",{style:{height:260},children:s.jsx(D,{children:s.jsxs(F,{data:z,children:[s.jsx(M,{strokeDasharray:"3 3"}),s.jsx(K,{dataKey:"name",interval:0,angle:-20,textAnchor:"end",height:70}),s.jsx(L,{allowDecimals:!1}),s.jsx(B,{}),s.jsx(W,{}),s.jsx(E,{dataKey:"saves",name:"Saves"}),s.jsx(E,{dataKey:"clicks",name:"Clicks"})]})})})]}),s.jsxs("div",{style:{marginTop:24},children:[s.jsx("h3",{style:{margin:"0 0 8px"},children:"Top Outbound Links"}),s.jsx("div",{className:"table-wrap",style:{overflowX:"auto"},children:s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{textAlign:"left"},children:"Host"}),s.jsx("th",{style:{textAlign:"right"},children:"Clicks"})]})}),s.jsx("tbody",{children:R.length?R.map(a=>s.jsxs("tr",{children:[s.jsx("td",{children:a.host}),s.jsx("td",{style:{textAlign:"right"},children:a.clicks})]},a.host)):s.jsx("tr",{children:s.jsx("td",{colSpan:2,className:"muted",children:"No outbound clicks yet."})})})]})})]})]})})}export{xs as default};
