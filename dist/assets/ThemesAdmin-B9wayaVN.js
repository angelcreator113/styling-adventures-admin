import{r as p,o as N,c as S,j as s,b as j,w as T,d as C,i as P,m as I,s as k}from"./index-Dpurs1Jy.js";import{B as R}from"./theme-service-yZ4BYXBV.js";function M(i){return i*Math.PI/180}function A(i,d,l,n){const a=n.radius??20,r=n.shadow??10;if(i.save(),i.shadowColor="rgba(0,0,0,.10)",i.shadowBlur=r,i.shadowOffsetY=Math.max(2,Math.round(r/3)),i.beginPath(),i.moveTo(a,0),i.lineTo(d-a,0),i.quadraticCurveTo(d,0,d,a),i.lineTo(d,l-a),i.quadraticCurveTo(d,l,d-a,l),i.lineTo(a,l),i.quadraticCurveTo(0,l,0,l-a),i.lineTo(0,a),i.quadraticCurveTo(0,0,a,0),i.closePath(),i.fillStyle="#fff",i.fill(),i.clip(),n.type==="solid")i.fillStyle=n.colors?.[0]||"#ffffff",i.fillRect(0,0,d,l);else{const c=M(n.angle??90),h=d/2,u=l/2,g=Math.cos(c),y=Math.sin(c),f=Math.max(d,l)*.75,x=i.createLinearGradient(h-g*f,u-y*f,h+g*f,u+y*f),b=n.colors?.length?n.colors:["#fafafa","#f1f1f1"];b.length===1?(x.addColorStop(0,b[0]),x.addColorStop(1,b[0])):b.forEach((v,w)=>x.addColorStop(w/(b.length-1),v)),i.fillStyle=x,i.fillRect(0,0,d,l)}i.restore()}function Y(i,d,l,n){const r=d*.76,c=l*(1-.12*2),h=Math.min(r/n.width,c/n.height),u=n.width*h,g=n.height*h,y=(d-u)/2,f=(l-g)/2;i.imageSmoothingQuality="high",i.drawImage(n,y,f,u,g)}function D(){const[i,d]=p.useState([]),[l,n]=p.useState(null),[a,r]=p.useState({label:"",type:"gradient",colors:["#f4ecff","#eadfff"],angle:90,radius:20,shadow:12,marginPct:.1,biasY:.03}),[c,h]=p.useState(null),u=p.useRef();p.useEffect(()=>{const e=N(S(j,"public/themes"),t=>{d(t.docs.map(o=>({id:o.id,...o.data()})))});return()=>e()},[]),p.useEffect(()=>{const e=u.current;if(!e)return;const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),A(t,e.width,e.height,a),c?Y(t,e.width,e.height,c):(t.save(),t.translate(e.width/2,e.height/2),t.fillStyle="#eee",t.beginPath(),t.arc(0,0,140,0,Math.PI*2),t.fill(),t.lineWidth=18,t.strokeStyle="#d7d7d7",t.stroke(),t.restore())},[a,c]);function g(e){n(e?.id||null),r({label:e?.label||"",type:e?.type||"gradient",colors:Array.isArray(e?.colors)&&e.colors.length?e.colors:["#f4ecff","#eadfff"],angle:Number.isFinite(e?.angle)?e.angle:90,radius:Number.isFinite(e?.radius)?e.radius:20,shadow:Number.isFinite(e?.shadow)?e.shadow:12,marginPct:Number.isFinite(e?.marginPct)?e.marginPct:.1,biasY:Number.isFinite(e?.biasY)?e.biasY:.03})}async function y(){const e={...a,updatedAt:k()};if(!a.label){alert("Label is required");return}const t=a.label.replace(/\s+/g,"");await T(C(j,"public/themes",t),e,{merge:!0}),n(t)}async function f(){n(null),r({label:"New Theme",type:"gradient",colors:["#ffffff","#f3f3f3"],angle:90,radius:20,shadow:10,marginPct:.1,biasY:0})}async function x(e){e&&confirm("Delete this theme?")&&(await P(C(j,"public/themes",e)),l===e&&n(null))}async function b(){const e=new Set((await I(S(j,"public/themes"))).docs.map(o=>o.id)),t=Object.entries(R);for(const[o,m]of t)e.has(o)||await T(C(j,"public/themes",o),{...m,seeded:!0,createdAt:k()});alert("Seeded defaults (if missing).")}async function v(e){const t=e.target.files?.[0];if(!t)return;const o=await createImageBitmap(t);h(o)}const w=p.useMemo(()=>(a.colors||[]).map((e,t)=>s.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s.jsx("input",{type:"color",value:e,onChange:o=>{const m=[...a.colors];m[t]=o.target.value,r({...a,colors:m})}}),s.jsx("input",{value:e,onChange:o=>{const m=[...a.colors];m[t]=o.target.value,r({...a,colors:m})}}),s.jsx("button",{type:"button",onClick:()=>{const o=[...a.colors];o.splice(t,1),r({...a,colors:o})},children:"Remove"})]},t)),[a.colors]);return s.jsxs("div",{className:"page pad",children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h2",{children:"Theme Library"}),s.jsxs("div",{style:{display:"flex",gap:8},children:[s.jsx("button",{onClick:f,children:"New"}),s.jsx("button",{onClick:b,children:"Seed defaults"})]})]}),s.jsxs("section",{style:{display:"grid",gridTemplateColumns:"280px 1fr",gap:16,alignItems:"start"},children:[s.jsx("aside",{style:{border:"1px solid #eee",borderRadius:12,padding:12,background:"#fff"},children:s.jsx("div",{style:{display:"grid",gap:8},children:i.map(e=>s.jsxs("button",{className:"chip",onClick:()=>g(e),style:{textAlign:"left",border:"1px solid #e5e7eb",padding:"8px 10px",borderRadius:10,background:l===e.id?"#f8faff":"#fff"},children:[s.jsx("div",{style:{fontWeight:600},children:e.label||e.id}),s.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[e.type," ",Array.isArray(e.colors)?`(${e.colors.length} colors)`:""]})]},e.id))})}),s.jsxs("main",{style:{display:"grid",gridTemplateColumns:"minmax(320px, 420px) 1fr",gap:20},children:[s.jsxs("div",{style:{border:"1px solid #eee",borderRadius:12,padding:12,background:"#fff",display:"grid",gap:10},children:[s.jsxs("label",{children:["Label ",s.jsx("input",{value:a.label,onChange:e=>r({...a,label:e.target.value})})]}),s.jsxs("label",{children:["Type",s.jsxs("select",{value:a.type,onChange:e=>r({...a,type:e.target.value}),children:[s.jsx("option",{value:"gradient",children:"gradient"}),s.jsx("option",{value:"solid",children:"solid"})]})]}),s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("strong",{children:"Colors"}),s.jsx("button",{type:"button",onClick:()=>r({...a,colors:[...a.colors||[],"#ffffff"]}),children:"Add color"})]}),s.jsx("div",{style:{display:"grid",gap:6,marginTop:6},children:w})]}),a.type==="gradient"&&s.jsxs("label",{children:["Angle",s.jsx("input",{type:"number",value:a.angle,onChange:e=>r({...a,angle:Number(e.target.value)})})]}),s.jsxs("label",{children:["Corner radius ",s.jsx("input",{type:"number",value:a.radius,onChange:e=>r({...a,radius:Number(e.target.value)})})]}),s.jsxs("label",{children:["Shadow blur ",s.jsx("input",{type:"number",value:a.shadow,onChange:e=>r({...a,shadow:Number(e.target.value)})})]}),s.jsxs("label",{children:["Margin % ",s.jsx("input",{type:"number",step:"0.01",value:a.marginPct,onChange:e=>r({...a,marginPct:Number(e.target.value)})})]}),s.jsxs("label",{children:["Bias Y ",s.jsx("input",{type:"number",step:"0.01",value:a.biasY,onChange:e=>r({...a,biasY:Number(e.target.value)})})]}),s.jsxs("div",{style:{display:"flex",gap:8},children:[s.jsx("button",{onClick:y,children:"Save"}),l&&s.jsx("button",{className:"danger",onClick:()=>x(l),children:"Delete"})]})]}),s.jsxs("div",{style:{border:"1px solid #eee",borderRadius:12,padding:12,background:"#fff"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[s.jsx("strong",{children:"Preview"}),s.jsx("input",{type:"file",accept:"image/*",onChange:v})]}),s.jsx("canvas",{ref:u,width:540,height:540,style:{width:"100%",maxWidth:540,display:"block",borderRadius:12}})]})]})]}),s.jsx("style",{children:`
        .page.pad { padding: 16px; }
        input, select, button { font: inherit; padding: 6px 8px; border-radius: 8px; border: 1px solid #e5e7eb; }
        button { background:#fff; cursor:pointer; }
        button:hover { background:#f9fafb; }
        button.danger { color:#b91c1c; border-color:#fca5a5; background:#fff5f5; }
        label { display:grid; gap:6px; margin-bottom:6px; font-size: 14px; }
      `})]})}export{D as default};
