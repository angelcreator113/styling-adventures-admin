import{f as A,r as a,q,a as W,c as F,o as T,d as B,j as e,b as C,v as me,n as Y,p as Z,i as H,a4 as he,h as pe,s as G,w as te,e as se}from"./index-Dpurs1Jy.js";import{a as be,i as xe}from"./upload-page-yXbAKKa7.js";import{l as ae,b as fe,e as ge}from"./board-helpers-BSw2y6wO.js";import{u as je}from"./useUserRole-xi4rwFu_.js";import"./firebase-helpers-C5EXP52w.js";import"./image-pipeline-NuN-Pp6Y.js";import"./index.esm-Cclw387c.js";import"./theme-service-yZ4BYXBV.js";const ee="closetDash:v3";function V(s=""){return s.toLowerCase().replace(new RegExp("(^|\\s|-|_)\\p{L}","gu"),o=>o.toUpperCase())}function le(s=""){const d=s.replace(/\.[a-z0-9]+$/i,"").split(/[\s_\-.,]+/).filter(c=>c&&!/^\d+$/.test(c)).filter(c=>!/^(img|image|screenshot|chatgpt|photo|pxl|mvimg|edited)$/i.test(c)).filter(c=>c.length>=3);return V(d.slice(0,5).join(" "))}function ye(s){const o=new Set,d=(s.category||"").trim(),c=(s.subcategory||"").trim(),j=(s.subsubcategory||"").trim();if((d||c||j)&&(o.add(V([d,c,j].filter(Boolean).join(" "))),o.add(V([d,c].filter(Boolean).join(" ")))),s.fileName){const f=le(s.fileName);f&&o.add(f)}return o.size||o.add("My Closet Item"),Array.from(o).slice(0,6)}function ve(){const s=A.currentUser?.uid||null,{role:o}=je(),d=o==="creator"||o==="admin",[c,j]=a.useState([]),[f,y]=a.useState(new Map),[N,k]=a.useState(!0),[v,l]=a.useState("all"),[n,b]=a.useState("date"),[S,I]=a.useState(""),[E,D]=a.useState(""),L=a.useRef(),[O,u]=a.useState(null),[p,i]=a.useState(""),[h,x]=a.useState(null),[R,U]=a.useState([]),[re,ne]=a.useState([]),[oe,J]=a.useState("");a.useEffect(()=>{if(!s)return;const t=ae(s,U);return()=>t?.()},[s]);const ce=t=>{const r=t.target.value;I(r),clearTimeout(L.current),L.current=setTimeout(()=>D(r.trim().toLowerCase()),220)};a.useEffect(()=>{try{const t=JSON.parse(localStorage.getItem(ee)||"{}");t.filterCat&&l(t.filterCat),t.sortBy&&b(t.sortBy),t.queryText&&(I(t.queryText),D(t.queryText.toLowerCase()))}catch{}},[]),a.useEffect(()=>{localStorage.setItem(ee,JSON.stringify({filterCat:v,sortBy:n,queryText:S}))},[v,n,S]),a.useEffect(()=>{if(!d)return;const t=q(F(C,"themes"),W("label","asc")),r=T(t,m=>{ne(m.docs.map(w=>({id:w.id,...w.data()})))});return()=>r()},[d]),a.useEffect(()=>{if(!s||!d)return;const t=B(C,`users/${s}/settings/brand`),r=T(t,m=>{const w=m.exists()&&m.data().themeId||"";J(w)});return()=>r()},[s,d]),a.useEffect(()=>{if(!s)return;const t=q(F(C,`users/${s}/closet`),W("uploadedAt","desc")),r=T(t,async m=>{const w=m.docs.map($=>({id:$.id,...$.data()}));j(w),k(!1),w.forEach(async $=>{const _=$.path||$.storagePath||"";if(!($.url||!_||f.has(_)))try{const g=await me(Y(Z,_));y(P=>{const X=new Map(P);return X.set(_,g),X})}catch{}})},()=>k(!1));return()=>r()},[s]);const ie=a.useMemo(()=>{const t=new Set;return c.forEach(r=>{const m=(r.category||"").trim();m&&t.add(m)}),["All Categories",...Array.from(t).sort()]},[c]),M=a.useMemo(()=>{let t=c.slice();return v!=="all"&&(t=t.filter(r=>(r.category||"").toLowerCase()===v.toLowerCase())),E&&(t=t.filter(r=>`${r.title||""} ${r.fileName||""}`.toLowerCase().includes(E))),n==="name"?t.sort((r,m)=>(r.title||r.fileName||"").localeCompare(m.title||m.fileName||"")):t.sort((r,m)=>(m.uploadedAt?.seconds||0)-(r.uploadedAt?.seconds||0)),t},[c,v,E,n]);async function de(t){if(s&&window.confirm("Delete this item (and its image)?")){j(r=>r.filter(m=>m.id!==t.id));try{await H(B(C,`users/${s}/closet/${t.id}`));const r=t.path||t.storagePath||"";if(r)try{await he(Y(Z,r)),y(m=>{const w=new Map(m);return w.delete(r),w})}catch{}}catch(r){console.warn("[closet] delete failed:",r)}}}function K(t){u(t.id),i(t.title||le(t.fileName||"")||""),x(null)}function z(){u(null),i(""),x(null)}async function Q(t){const r=p.trim();if(!r)return z();try{await pe(B(C,`users/${s}/closet/${t.id}`),{title:r,updatedAt:G()})}catch(m){console.warn("rename failed",m)}finally{z()}}async function ue(t){if(s)try{await te(B(C,`users/${s}/settings/brand`),{uid:s,themeId:t,updatedAt:G()},{merge:!0})}catch(r){console.warn("[brand] save failed",r)}}return e.jsxs("section",{className:"card dashboard","aria-labelledby":"closet-dash-title",children:[e.jsxs("div",{className:"card__body",children:[e.jsx("h3",{id:"closet-dash-title",className:"card__title",children:"Closet Dashboard"}),e.jsxs("div",{className:"toolbar toolbar--closet",children:[e.jsx("select",{"aria-label":"Filter by category",value:v,onChange:t=>l(t.target.value),children:ie.map(t=>e.jsx("option",{value:t==="All Categories"?"all":t.toLowerCase(),children:t},t))}),e.jsxs("select",{"aria-label":"Sort",value:n,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"date",children:"Newest"}),e.jsx("option",{value:"name",children:"Name A–Z"})]}),d&&e.jsxs("select",{"aria-label":"Theme",value:oe,onChange:t=>{J(t.target.value),ue(t.target.value)},title:"Theme used for new preview cards",children:[e.jsx("option",{value:"",children:"Theme: default"}),re.map(t=>e.jsx("option",{value:t.id,children:t.label||t.id},t.id))]}),e.jsx("input",{type:"search",placeholder:"Search title or file…",value:S,onChange:ce}),e.jsxs("span",{className:"muted",children:[M.length," item",M.length!==1?"s":""]})]}),e.jsxs("div",{className:"dashboard-grid",children:[N&&Array.from({length:6}).map((t,r)=>e.jsxs("article",{className:"closet-card is-skel",children:[e.jsx("div",{className:"closet-thumb",children:e.jsx("div",{className:"skel-box"})}),e.jsxs("div",{className:"closet-meta",children:[e.jsx("div",{className:"skel-line"}),e.jsx("div",{className:"skel-line short"})]})]},`sk-${r}`)),!N&&M.length===0&&e.jsx("div",{className:"empty",children:e.jsx("p",{children:"No items yet. Upload something on the left ✨"})}),!N&&M.map(t=>{const r=t.path||t.storagePath||"",m=t.assets?.preview?.url||t.url||(r?f.get(r):""),w=t.title||t.fileName||"Untitled",$=ye(t),_=O===t.id;return e.jsxs("article",{className:"closet-card",children:[e.jsxs("div",{className:"closet-thumb",children:[m?e.jsx("img",{src:m,alt:"",loading:"lazy",decoding:"async",style:{maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",objectFit:"contain",objectPosition:"center",display:"block"}}):e.jsx("span",{className:"closet-thumb__placeholder",children:"no image"}),e.jsx("span",{className:`badge ${t.visibility==="public"?"badge--pub":"badge--priv"}`,children:t.visibility||"private"})]}),e.jsx("div",{className:"closet-meta",children:_?e.jsxs("div",{className:"rename-wrap",children:[e.jsx("input",{className:"rename-input",value:p,autoFocus:!0,onChange:g=>i(g.target.value),onKeyDown:g=>{g.key==="Enter"&&Q(t),g.key==="Escape"&&z()},placeholder:"Enter a better name…"}),e.jsxs("div",{className:"rename-actions",children:[e.jsx("button",{className:"tb-btn",onClick:()=>Q(t),children:"Save"}),e.jsx("button",{className:"tb-btn",onClick:z,children:"Cancel"}),e.jsx("button",{className:"tb-btn",onClick:()=>x(g=>g===t.id?null:t.id),children:"Ideas"})]}),h===t.id&&e.jsx("div",{className:"ideas-pop",children:$.map(g=>e.jsx("button",{className:"idea",type:"button",onClick:()=>i(g),children:g},g))})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title",title:w,onDoubleClick:()=>K(t),children:w}),e.jsxs("div",{className:"chips",children:[t.category&&e.jsx("span",{className:"chip",children:t.category}),t.subcategory&&e.jsx("span",{className:"chip",children:t.subcategory}),t.subsubcategory&&e.jsx("span",{className:"chip",children:t.subsubcategory})]})]})}),e.jsxs("div",{className:"closet-actions",children:[e.jsxs("select",{onChange:g=>{const P=g.target.value;P&&(fe({uid:s,boardId:P,itemId:t.id,previewUrl:m,category:t.category||""}),g.target.value="")},defaultValue:"",className:"tb-btn",style:{minWidth:140},"aria-label":"Add to board",children:[e.jsx("option",{value:"",disabled:!0,children:"Add to board…"}),R.map(g=>e.jsx("option",{value:g.id,children:g.label||g.key},g.id))]}),_?e.jsx("span",{className:"muted",children:"Editing…"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"tb-btn",onClick:()=>K(t),children:"Rename"}),e.jsx("button",{className:"tb-btn danger",onClick:()=>de(t),children:"Delete"})]})]})]},t.id)})]})]}),e.jsx("style",{children:`
        .toolbar--closet { display:flex; gap:.5rem; align-items:center; margin-bottom:.75rem; }
        .toolbar--closet input[type="search"] { flex:1; min-width: 220px; }

        .dashboard-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }

        .closet-card { display:flex; flex-direction:column; gap:.5rem; }
        .closet-thumb {
          position: relative;
          width: 100%;
          aspect-ratio: 3/4;
          overflow: hidden;
          border-radius: 12px;
          background: #fff;
          border: 1px solid #eee;
          display: grid;
          place-items: center;
        }
        .closet-thumb__placeholder { position:absolute; inset:0; display:grid; place-items:center; color:#999; font-size:12px; }
        .badge { position:absolute; top:8px; left:8px; font-size:11px; padding:2px 8px; border-radius:999px; color:#fff; background: rgba(0,0,0,.65); }
        .badge--pub { background: rgba(99,102,241,.9); } .badge--priv { background: rgba(107,114,128,.9); }

        .closet-meta .title { font-weight:600; font-size:.95rem; cursor:text; }
        .chips { display:flex; gap:6px; flex-wrap:wrap; margin-top:4px; }
        .chip { font-size: 11px; padding: 2px 8px; border-radius: 999px; background: #f3f4f6; color:#374151; border:1px solid #e5e7eb; }

        .closet-actions { display:flex; gap:.5rem; flex-wrap: wrap; }
        .tb-btn { font-size:.9rem; padding:.35rem .6rem; border-radius:8px; border:1px solid #e5e7eb; background:#fff; }
        .tb-btn:hover { background:#f9f9fb; }
        .tb-btn.danger { color:#b91c1c; border-color:#fca5a5; background:#fff5f5; }
        .tb-btn.danger:hover { background:#ffe9e9; }

        .rename-wrap { display:flex; flex-direction:column; gap:.4rem; }
        .rename-input { width:100%; padding:.45rem .6rem; border-radius:8px; border:1px solid #e5e7eb; }
        .rename-actions { display:flex; gap:.4rem; }
        .ideas-pop { margin-top:.25rem; display:flex; gap:.25rem; flex-wrap:wrap; }
        .ideas-pop .idea { border:1px dashed #d1d5db; background:#fbfbff; border-radius:999px; padding:.2rem .6rem; font-size:.85rem; }
        .ideas-pop .idea:hover { background:#f0f0ff; }

        .closet-card.is-skel .skel-box { width:100%; height:100%; aspect-ratio:3/4; border-radius:10px; background: linear-gradient(90deg,#eee 25%,#f5f5f5 37%,#eee 63%); background-size: 400% 100%; animation: shimmer 1.1s infinite linear; }
        .closet-card.is-skel .skel-line { height:12px; margin-top:8px; border-radius:6px; background:#eee; }
        .closet-card.is-skel .skel-line.short { width:60%; }
        @keyframes shimmer { 0%{background-position:100% 0} 100%{background-position:0 0} }

        .empty { padding: 1.25rem; color:#6b7280; }
      `})]})}function Ne({uiPrefix:s="",onClose:o}){const d=a.useRef(null),c=a.useRef(new Image),[j,f]=a.useState(!1),[y,N]=a.useState(!1),[k,v]=a.useState(26),l=a.useRef([]);a.useEffect(()=>{async function u(){let p=window.__bestie_lastBlob||null;if(p)await n(p);else{const i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=async h=>{const x=h.target.files?.[0];x&&await n(x)},i.click()}}u()},[]);async function n(u){const p=URL.createObjectURL(u),i=c.current;i.onload=()=>{const h=d.current;if(!h)return;const x=Math.min(window.innerWidth-80,960),R=Math.min(1,x/i.width);h.width=Math.round(i.width*R),h.height=Math.round(i.height*R);const U=h.getContext("2d");U.clearRect(0,0,h.width,h.height),U.drawImage(i,0,0,h.width,h.height),l.current=[],b(),f(!0),URL.revokeObjectURL(p)},i.onerror=()=>f(!1),i.src=p}function b(){const u=d.current;if(u)try{const p=u.toDataURL("image/png");l.current.push(p),l.current.length>20&&l.current.shift()}catch{}}function S(){if(l.current.length<2)return;l.current.pop();const u=l.current[l.current.length-1],p=new Image;p.onload=()=>{const i=d.current;if(!i)return;const h=i.getContext("2d");h.clearRect(0,0,i.width,i.height),h.drawImage(p,0,0,i.width,i.height)},p.src=u}function I(u,p,i){const h=d.current;if(!h)return;const x=h.getContext("2d");if(x.save(),x.globalCompositeOperation=i?"destination-out":"source-over",i)x.beginPath(),x.arc(u,p,k/2,0,Math.PI*2),x.fill();else{const R=document.createElement("canvas");R.width=h.width,R.height=h.height,R.getContext("2d").drawImage(c.current,0,0,h.width,h.height),x.beginPath(),x.arc(u,p,k/2,0,Math.PI*2),x.closePath(),x.clip(),x.drawImage(R,0,0)}x.restore()}function E(u){if(!j)return;const p=d.current;if(!p)return;const i=p.getBoundingClientRect(),h=u.clientX-i.left,x=u.clientY-i.top,R=!u.altKey&&!y;I(h,x,R)}function D(u){j&&(b(),E(u),window.addEventListener("pointermove",E),window.addEventListener("pointerup",L,{once:!0}))}function L(){window.removeEventListener("pointermove",E)}async function O(){const u=d.current;u&&u.toBlob(p=>{if(!p)return;const i=new CustomEvent("bestie:manualProcess",{detail:{blob:p,uiPrefix:s}});document.dispatchEvent(i),o?.()},"image/png")}return e.jsx("div",{className:"modal-scrim",role:"dialog","aria-modal":"true",children:e.jsx("div",{className:"card modal",children:e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{className:"row",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{className:"card__title",style:{margin:0},children:"Manual Editor"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("label",{className:"tb-btn",style:{display:"inline-flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:y,onChange:u=>N(u.target.checked)}),"Restore mode"]}),e.jsxs("label",{className:"tb-btn",style:{display:"inline-flex",alignItems:"center",gap:8},children:["Brush ",e.jsx("input",{type:"range",min:"8",max:"80",value:k,onChange:u=>v(parseInt(u.target.value||"26",10))})]}),e.jsx("button",{className:"tb-btn",onClick:S,children:"Undo"}),e.jsx("button",{className:"tb-btn danger",onClick:o,children:"Close"})]})]}),e.jsx("div",{className:"editor-area",style:{marginTop:12},children:e.jsx("canvas",{ref:d,onPointerDown:D,style:{display:"block",maxWidth:"100%",cursor:"crosshair"}})}),e.jsx("div",{className:"row",style:{marginTop:12},children:e.jsx("button",{className:"tb-btn primary",onClick:O,children:"Apply & Continue"})})]})})})}function ke(){const s=A.currentUser?.uid,[o,d]=a.useState(!0),[c,j]=a.useState([]),[f,y]=a.useState("");a.useEffect(()=>{if(!s)return;ge(s);const l=ae(s,j),n=T(B(C,`users/${s}/settings/boards`),b=>{d(b.exists()?!!b.data()?.autoByCategory:!0)});return()=>{l?.(),n?.()}},[s]);async function N(l){s&&await te(B(C,`users/${s}/settings/boards`),{autoByCategory:l},{merge:!0})}async function k(){if(!s)return;const l=f.trim();l&&(await se(F(C,`users/${s}/boards`),{label:l,createdAt:new Date}),y(""))}async function v(l,n){!s||n||window.confirm("Delete this board? Items will remain in Closet.")&&await H(B(C,`users/${s}/boards/${l}`))}return e.jsx("div",{className:"tool-block",children:e.jsxs("div",{className:"tool-row",style:{alignItems:"center"},children:[e.jsx("div",{className:"tool-title",children:"Boards"}),e.jsx("div",{className:"tool-sub",children:"Organize looks like Pinterest. Auto-create boards from categories if you like."}),e.jsxs("label",{className:"tool-check",style:{gridColumn:"1 / -1"},children:[e.jsx("input",{type:"checkbox",checked:o,onChange:l=>{d(l.target.checked),N(l.target.checked)}}),e.jsx("span",{className:"tool-title",children:"Auto-add new uploads to a board by category"})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",gap:8},children:[e.jsx("input",{className:"input",placeholder:"New board name (e.g., ‘Vacation Fits’)",value:f,onChange:l=>y(l.target.value),style:{flex:1}}),e.jsx("button",{type:"button",className:"tb-btn",onClick:k,children:"Create"})]}),e.jsxs("ul",{style:{gridColumn:"1 / -1",listStyle:"none",padding:0,margin:"8px 0",display:"grid",gap:8},children:[c.map(l=>e.jsxs("li",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 10px",border:"1px solid var(--border)",borderRadius:10},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[l.coverUrl?e.jsx("img",{src:l.coverUrl,alt:"",width:36,height:36,style:{borderRadius:8,objectFit:"cover"}}):e.jsx("div",{style:{width:36,height:36,borderRadius:8,background:"#f4f4f8"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:l.label||l.key}),l.locked&&e.jsx("div",{className:"muted",style:{fontSize:12},children:"Locked default"})]})]}),e.jsx("div",{children:!l.locked&&e.jsx("button",{className:"tb-btn danger",onClick:()=>v(l.id,l.locked),children:"Delete"})})]},l.id)),!c.length&&e.jsx("li",{className:"muted",children:"No boards yet."})]})]})})}const we=[{id:"appearance",label:"Appearance"},{id:"naming",label:"Naming"},{id:"cats",label:"Categories"},{id:"boards",label:"Boards"},{id:"advanced",label:"Advanced"}];function Ce({uiPrefix:s=""}){const[o,d]=a.useState("appearance"),[c,j]=a.useState(!1),[f,y]=a.useState([]),[N,k]=a.useState("");a.useEffect(()=>{const n=A.currentUser;if(!n)return;const b=q(F(C,`users/${n.uid}/categories`),W("label","asc"));return T(b,I=>y(I.docs.map(E=>({id:E.id,...E.data()}))))},[]);async function v(){const n=(N||"").trim();n&&(await se(F(C,`users/${A.currentUser.uid}/categories`),{label:n}),k(""))}async function l(n){await H(B(C,`users/${A.currentUser.uid}/categories/${n}`))}return e.jsxs("div",{className:"toolbox",children:[e.jsxs("header",{className:"toolbox__hd",children:[e.jsx("h2",{className:"card__title",style:{margin:0},children:"Bestie Toolbox"}),e.jsx("nav",{className:"tabs",children:we.map(n=>e.jsx("button",{className:`tab ${o===n.id?"is-active":""}`,onClick:()=>d(n.id),children:n.label},n.id))})]}),e.jsxs("div",{className:"toolbox__body",children:[o==="appearance"&&e.jsx("div",{className:"tool-block",children:e.jsxs("div",{className:"tool-row",children:[e.jsx("div",{className:"tool-title",children:"Brand look"}),e.jsx("div",{className:"tool-sub",children:"We’ll make a cute preview + icons for your closet and boards."}),e.jsxs("label",{className:"tool-check",children:[e.jsx("span",{className:"tool-title",children:"Theme"}),e.jsxs("select",{id:`${s}appearance-theme`,defaultValue:"lavender",className:"input",style:{marginLeft:8},children:[e.jsx("option",{value:"lavender",children:"Lavender"}),e.jsx("option",{value:"sky",children:"Sky"}),e.jsx("option",{value:"cream",children:"Ivory/Cream"})]})]}),e.jsx("hr",{style:{gridColumn:"1 / -1",opacity:.2}}),e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}export-preview`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Make a pretty preview (1024)"})]}),e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}export-icon`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Make a 500×500 icon"})]}),e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}export-icon-hover`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Also make a hover icon"})]}),e.jsx("hr",{style:{gridColumn:"1 / -1",opacity:.2}}),e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}feat-trim`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Remove background"})]}),e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}feat-server`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Use pro cutout (sharper edges)"})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("button",{type:"button",className:"tb-btn",onClick:()=>j(!0),children:"Manual Editor…"}),e.jsx("div",{className:"tool-sub",children:"Brush erase/restore with undo, then “Apply & Continue”."})]})]})}),o==="naming"&&e.jsx("div",{className:"tool-block",children:e.jsxs("div",{className:"tool-row",children:[e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}feat-autoname`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Auto name my upload"})]}),e.jsx("div",{className:"tool-sub",children:"We’ll read the file & category to suggest a cute title."})]})}),o==="cats"&&e.jsx("div",{className:"tool-block",children:e.jsxs("div",{className:"tool-row",children:[e.jsx("div",{className:"tool-title",children:"My category names"}),e.jsx("div",{className:"tool-sub",children:"Rename or add your own. These show up in the upload form."}),e.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",gap:8},children:[e.jsx("input",{value:N,onChange:n=>k(n.target.value),placeholder:"e.g. My Sparkles",className:"input",style:{flex:1}}),e.jsx("button",{className:"tb-btn",type:"button",onClick:v,children:"Add"})]}),e.jsxs("ul",{style:{gridColumn:"1 / -1",margin:"8px 0 0",padding:0,listStyle:"none",display:"grid",gap:8},children:[f.map(n=>e.jsxs("li",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"6px 8px",border:"1px solid var(--border)",borderRadius:10},children:[e.jsx("span",{children:n.label}),e.jsx("button",{className:"tb-btn danger",onClick:()=>l(n.id),children:"Delete"})]},n.id)),!f.length&&e.jsx("li",{className:"muted",children:"No custom categories yet."})]})]})}),o==="boards"&&e.jsx(ke,{}),o==="advanced"&&e.jsx("div",{className:"tool-block",children:e.jsxs("div",{className:"tool-row",children:[e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}feat-compress`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Smart compress"})]}),e.jsx("div",{className:"tool-sub",children:"Faster uploads, same quality."}),e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}feat-pad`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Pad to square"})]}),e.jsxs("label",{className:"tool-check",children:[e.jsx("input",{id:`${s}feat-public`,type:"checkbox",defaultChecked:!0}),e.jsx("span",{className:"tool-title",children:"Make Public"})]})]})})]}),c&&e.jsx(Ne,{uiPrefix:s,onClose:()=>j(!1)})]})}function Se({open:s,onClose:o,onCapture:d}){const c=a.useRef(null),[j,f]=a.useState("environment"),[y,N]=a.useState(null);a.useEffect(()=>{if(!s)return;let b;return(async()=>{try{b=await navigator.mediaDevices.getUserMedia({video:{facingMode:j},audio:!1}),c.current&&(c.current.srcObject=b,await c.current.play())}catch{alert("Camera unavailable"),o?.()}})(),()=>b&&b.getTracks().forEach(I=>I.stop())},[s,j,o]);async function k(){const b=c.current;if(!b)return;const S=document.createElement("canvas");S.width=b.videoWidth,S.height=b.videoHeight,S.getContext("2d").drawImage(b,0,0),S.toBlob(I=>N(I),"image/jpeg",.92)}function v(){N(null)}function l(){f(b=>b==="environment"?"user":"environment")}function n(){y&&d?.(y),o?.()}return s?e.jsxs("div",{className:"cam-ovl",children:[e.jsxs("div",{className:"cam-box",children:[y?e.jsx("img",{src:URL.createObjectURL(y),alt:"",className:"cam-shot"}):e.jsx("video",{ref:c,playsInline:!0,muted:!0,className:"cam-video"}),e.jsx("div",{className:"cam-ctrl",children:y?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",onClick:v,children:"Retake"}),e.jsx("button",{className:"btn primary",onClick:n,children:"Use Photo"}),e.jsx("button",{className:"btn",onClick:l,children:"Flip"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn",onClick:l,children:"Flip"}),e.jsx("button",{className:"btn primary",onClick:k,children:"Capture"}),e.jsx("button",{className:"btn",onClick:o,children:"Close"})]})})]}),e.jsx("style",{children:`
        .cam-ovl{position:fixed;inset:0;background:rgba(20,33,54,.6);display:grid;place-items:center;z-index:1200}
        .cam-box{width:min(720px,92vw);aspect-ratio:3/4;background:#000;border-radius:16px;overflow:hidden;position:relative}
        .cam-video,.cam-shot{width:100%;height:100%;object-fit:cover;display:block}
        .cam-ctrl{position:absolute;left:0;right:0;bottom:0;display:flex;gap:8px;justify-content:center;padding:10px;background:linear-gradient(to top,rgba(0,0,0,.4),transparent)}
        .btn{height:40px;padding:0 14px;border-radius:10px;border:1px solid rgba(255,255,255,.3);background:rgba(255,255,255,.1);color:#fff}
        .btn.primary{background:#84D2F6;border-color:#84D2F6;color:#142136;font-weight:700}
      `})]}):null}function Te(){const[s,o]=a.useState(!1),[d,c]=a.useState(!1),j=a.useRef(null);return a.useEffect(()=>{const{ingest:f}=be("closet","closet-");j.current=f,xe({panelId:"closet-panel"})},[]),e.jsxs("div",{className:"upload-page",children:[e.jsxs("div",{className:"upload-page-grid v2",children:[e.jsx("section",{id:"closet-panel",className:"card up-card","aria-labelledby":"closet-upload-title",children:e.jsxs("div",{className:"card__body",children:[e.jsx("h2",{id:"closet-upload-title",className:"card__title",children:"Closet Upload"}),e.jsx("p",{className:"muted",children:"Drag & drop an image, click to choose a file, or use your camera."}),e.jsx("div",{id:"closet-drop-area",className:"drop-zone",role:"button",tabIndex:0,onClick:()=>document.getElementById("closet-file-input")?.click(),children:"Choose a file…"}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx("button",{id:"closet-camera-btn",className:"tb-btn",type:"button",onClick:()=>c(!0),children:"Use Camera"})}),e.jsx("input",{id:"closet-file-input",type:"file",accept:"image/*",capture:"environment",hidden:!0}),e.jsx("div",{id:"closet-file-list",className:"file-list","data-empty":"true"}),e.jsx("progress",{id:"closet-progress",max:"100",value:"0",hidden:!0}),e.jsx("div",{id:"closet-progress-label",className:"muted"}),e.jsxs("form",{id:"closet-upload-form",style:{marginTop:16},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"closet-category",children:"Category"}),e.jsx("select",{id:"closet-category",className:"smart-dropdown",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"closet-subcategory",children:"Subcategory"}),e.jsx("select",{id:"closet-subcategory",className:"smart-dropdown"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"closet-subsubcategory",children:"Sub-subcategory"}),e.jsx("select",{id:"closet-subsubcategory",className:"smart-dropdown"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"closet-title",children:"Title (optional)"}),e.jsx("input",{id:"closet-title",type:"text"})]}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"closet-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"closet-notes",rows:3})]}),e.jsx("button",{type:"button",className:"link",onClick:()=>o(!1),children:"Hide Notes"})]}):e.jsx("button",{type:"button",className:"link",onClick:()=>o(!0),children:"Add Notes"}),e.jsx("div",{className:"row",style:{marginTop:12},children:e.jsx("button",{id:"closet-upload-btn",className:"tb-btn primary",type:"button",children:"Upload to Closet"})})]})]})}),e.jsx("section",{className:"card dash-card",children:e.jsxs("div",{className:"card__body",children:[e.jsx("h2",{className:"card__title",children:"Closet Dashboard"}),e.jsx(ve,{})]})}),e.jsx("section",{className:"card toolbox-card",children:e.jsx(Ce,{uiPrefix:"closet-"})})]}),e.jsx(Se,{open:d,onClose:()=>c(!1),onCapture:f=>j.current?.(f)})]})}export{Te as default};
